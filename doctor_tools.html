<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Doctor Tools — Lekaren Tina</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.4;margin:0;padding:0;background:#f6f7fb;color:#111}
    header{background:#0066cc;color:white;padding:16px 20px}
    .container{max-width:1000px;margin:20px auto;padding:16px;background:white;border-radius:8px;box-shadow:0 6px 18px rgba(15,30,60,0.08)}
    .tools{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .card{padding:12px;border:1px solid #e6eefb;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.8),rgba(250,250,255,0.8))}
    label{display:block;margin-top:8px;font-size:0.9rem}
    input,select,button{width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ccdff6}
    .hidden{display:none}
    .signin{display:flex;gap:8px;align-items:center}
    .small{font-size:0.85rem;color:#444}
    .tools-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    footer{max-width:1000px;margin:12px auto;text-align:center;color:#666}
    .warning{background:#fff4e5;border-left:4px solid #ffb020;padding:10px;border-radius:6px}
    .ok{background:#eefbf3;border-left:4px solid #2fb76a;padding:10px;border-radius:6px}
    .pill{display:inline-block;background:#eef2ff;color:#27408b;padding:4px 8px;border-radius:999px;font-weight:600}
  </style>
</head>
<body>
  <header>
    <div style="max-width:1000px;margin:0 auto;display:flex;justify-content:space-between;align-items:center">
      <div>
        <h1 style="margin:0;font-size:1.25rem">Doctor Tools — Lekaren Tina</h1>
        <div class="small">A collection of handy clinical utilities — client-side only. Sign in to use.</div>
      </div>
      <div id="authArea" class="signin">
        <div id="userBadge" class="small hidden"></div>
        <button id="signinGitHub">Sign in with GitHub</button>
        <button id="signinDemo">Sign in (Demo)</button>
        <button id="signoutBtn" class="hidden">Sign out</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="notice" class="warning">
      <strong>Important:</strong> These tools run entirely in your browser and are provided for educational/demonstration purposes only. They are not a substitute for professional medical judgment. Do not use them as the sole basis for clinical decisions.
    </section>

    <section style="margin-top:12px">
      <div class="tools-header">
        <h2 style="margin:0">Tools</h2>
        <div class="small">Status: <span id="status" class="pill">signed out</span></div>
      </div>

      <div id="toolsGrid" class="tools hidden" aria-hidden="true">
        <!-- BMI -->
        <div class="card">
          <h3>BMI Calculator</h3>
          <label>Weight (kg)<input id="bmiWeight" type="number" step="0.1"></label>
          <label>Height (cm)<input id="bmiHeight" type="number" step="0.1"></label>
          <button onclick="calcBMI()">Calculate BMI</button>
          <div id="bmiResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- Dose per kg -->
        <div class="card">
          <h3>Dose (mg/kg)</h3>
          <label>Patient weight (kg)<input id="doseWeight" type="number" step="0.1"></label>
          <label>Dose (mg/kg)<input id="dosePerKg" type="number" step="0.01"></label>
          <button onclick="calcDose()">Calculate Total Dose</button>
          <div id="doseResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- IV Drip Rate -->
        <div class="card">
          <h3>IV Drip Rate</h3>
          <label>Volume (mL)<input id="ivVolume" type="number" step="1"></label>
          <label>Time (hours)<input id="ivHours" type="number" step="0.1"></label>
          <label>Set (drops/mL)<input id="ivSet" type="number" value="20"></label>
          <button onclick="calcIV()">Calculate Rate</button>
          <div id="ivResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- BSA -->
        <div class="card">
          <h3>Body Surface Area (Mosteller)</h3>
          <label>Weight (kg)<input id="bsaW" type="number" step="0.1"></label>
          <label>Height (cm)<input id="bsaH" type="number" step="0.1"></label>
          <button onclick="calcBSA()">Calculate BSA</button>
          <div id="bsaResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- Pregnancy Due Date -->
        <div class="card">
          <h3>Pregnancy — EDD Calculator</h3>
          <label>Last Menstrual Period (LMP)<input id="lmp" type="date"></label>
          <button onclick="calcEDD()">Calculate EDD</button>
          <div id="eddResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- Temperature converter -->
        <div class="card">
          <h3>Temperature Converter</h3>
          <label>Temperature<input id="tempInput" type="number" step="0.1"></label>
          <label>From<select id="tempFrom"><option value="c">°C</option><option value="f">°F</option><option value="k">K</option></select></label>
          <label>To<select id="tempTo"><option value="f">°F</option><option value="c">°C</option><option value="k">K</option></select></label>
          <button onclick="convTemp()">Convert</button>
          <div id="tempResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- Unit Converter (weight/volume) -->
        <div class="card">
          <h3>Unit Converter</h3>
          <label>Value<input id="unitVal" type="number" step="0.01"></label>
          <label>Convert<select id="unitType"><option value="mg_to_g">mg → g</option><option value="g_to_mg">g → mg</option><option value="ml_to_l">mL → L</option><option value="l_to_ml">L → mL</option><option value="mcg_to_mg">µg → mg</option></select></label>
          <button onclick="unitConv()">Convert</button>
          <div id="unitResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- Appointment scheduler (local) -->
        <div class="card">
          <h3>Appointment Scheduler</h3>
          <label>Patient name<input id="apptName" type="text"></label>
          <label>Date & time<input id="apptDT" type="datetime-local"></label>
          <button onclick="saveAppt()">Save</button>
          <div id="apptList" class="small" style="margin-top:8px"></div>
        </div>

        <!-- Symptom Checker (simple) -->
        <div class="card">
          <h3>Symptom Triage (very simple)</h3>
          <label>Fever?<select id="symFever"><option value="no">No</option><option value="yes">Yes</option></select></label>
          <label>Difficulty breathing?<select id="symBreath"><option value="no">No</option><option value="yes">Yes</option></select></label>
          <label>Chest pain?<select id="symChest"><option value="no">No</option><option value="yes">Yes</option></select></label>
          <button onclick="symptomTriage()">Triage</button>
          <div id="symResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- ECG: HR from RR (for adults) -->
        <div class="card">
          <h3>ECG — Heart rate from RR (s)</h3>
          <label>RR interval (s)<input id="ecgRR" type="number" step="0.01"></label>
          <button onclick="calcHR()">Calculate HR</button>
          <div id="ecgResult" class="small" style="margin-top:8px"></div>
        </div>

        <!-- Calculator: Quick drug infusion rate (mcg/kg/min) -->
        <div class="card">
          <h3>Infusion — mcg/kg/min</h3>
          <label>Concentration (mg in mL)<input id="infMg" type="number" step="0.01" placeholder="mg"></label>
          <label>Volume (mL)<input id="infVol" type="number" step="0.1" placeholder="mL"></label>
          <label>Dose (mcg/kg/min)<input id="infDose" type="number" step="0.1"></label>
          <label>Weight (kg)<input id="infW" type="number" step="0.1"></label>
          <button onclick="calcInfusion()">Calculate mL/hr</button>
          <div id="infResult" class="small" style="margin-top:8px"></div>
        </div>

      </div>

      <div id="lockedInfo" class="small" style="margin-top:12px">You must sign in to view and use the tools above.</div>
    </section>

  </main>

  <footer>
    <div class="small">Created by Lekaren Tina — &copy; 2025 — Use responsibly</div>
  </footer>

<script>
// Simple client-side gating: tools are shown only after a sign-in flow completes.
// NOTE: This is a demo gating mechanism. A real production site should validate
// identity on the server and protect any sensitive data and clinical logic.

const STATE_KEY = 'doctor_tools_user';
const statusEl = document.getElementById('status');
const toolsGrid = document.getElementById('toolsGrid');
const lockedInfo = document.getElementById('lockedInfo');
const userBadge = document.getElementById('userBadge');
const signoutBtn = document.getElementById('signoutBtn');

function setSignedIn(user){
  localStorage.setItem(STATE_KEY, JSON.stringify(user));
  updateUI();
}
function signOut(){
  localStorage.removeItem(STATE_KEY);
  updateUI();
}
function getUser(){
  try{return JSON.parse(localStorage.getItem(STATE_KEY));}catch(e){return null}
}

function updateUI(){
  const u = getUser();
  if(u){
    statusEl.textContent = 'signed in';
    toolsGrid.classList.remove('hidden');
    toolsGrid.setAttribute('aria-hidden','false');
    lockedInfo.classList.add('hidden');
    userBadge.classList.remove('hidden');
    userBadge.textContent = u.login ? u.login : 'User';
    signoutBtn.classList.remove('hidden');
    document.getElementById('signinGitHub').style.display='none';
    document.getElementById('signinDemo').style.display='none';
  } else {
    statusEl.textContent = 'signed out';
    toolsGrid.classList.add('hidden');
    toolsGrid.setAttribute('aria-hidden','true');
    lockedInfo.classList.remove('hidden');
    userBadge.classList.add('hidden');
    signoutBtn.classList.add('hidden');
    document.getElementById('signinGitHub').style.display='inline-block';
    document.getElementById('signinDemo').style.display='inline-block';
  }
}

// Sign-in buttons
// 1) GitHub OAuth link — client-side only: replace CLIENT_ID with your OAuth app id.
// Note: Without a server to exchange the code for a token, this will only capture
// the "code" query parameter and store it locally as a demo flag. To do real OAuth
// you need a server that exchanges the code for an access token.

const GITHUB_CLIENT_ID = 'YOUR_GITHUB_OAUTH_CLIENT_ID'; // <-- replace to enable real flow
const REDIRECT_URI = window.location.origin + window.location.pathname;

document.getElementById('signinGitHub').addEventListener('click', ()=>{
  if(!GITHUB_CLIENT_ID || GITHUB_CLIENT_ID === 'YOUR_GITHUB_OAUTH_CLIENT_ID'){
    alert('GitHub OAuth client_id is not set in the page. Use Demo sign-in or replace GITHUB_CLIENT_ID in the file.');
    return;
  }
  const state = Math.random().toString(36).slice(2);
  const url = `https://github.com/login/oauth/authorize?client_id=${encodeURIComponent(GITHUB_CLIENT_ID)}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=read:user&state=${state}`;
  window.location.href = url;
});

// 2) Demo sign in (local only)
document.getElementById('signinDemo').addEventListener('click', ()=>{
  const name = prompt('Enter a display name for demo sign-in (e.g. Dr. Smith)') || 'Demo Doctor';
  setSignedIn({login:name, demo:true});
});

signoutBtn.addEventListener('click', ()=>{signOut();});

// If redirected back from GitHub OAuth you'll see ?code=... We capture it and mark signed-in.
(function handleOAuthReturn(){
  const params = new URLSearchParams(window.location.search);
  const code = params.get('code');
  const state = params.get('state');
  if(code){
    // For demo purposes we store a pseudo-user. A real app must exchange 'code' for an access token server-side.
    const pseudoUser = {login: 'github-user', code: code};
    setSignedIn(pseudoUser);
    // Clean URL (remove code)
    const url = new URL(window.location.href);
    url.search = '';
    window.history.replaceState({}, document.title, url.toString());
  }
})();

updateUI();

// Tool functions
function calcBMI(){
  const w = parseFloat(document.getElementById('bmiWeight').value);
  const h = parseFloat(document.getElementById('bmiHeight').value)/100;
  const out = document.getElementById('bmiResult');
  if(!w || !h){out.textContent='Enter weight and height.';return}
  const bmi = w/(h*h);
  let cat = 'Normal';
  if(bmi<18.5)cat='Underweight';
  else if(bmi>=25)cat='Overweight/Obese';
  out.textContent = `BMI: ${bmi.toFixed(1)} — ${cat}`;
}

function calcDose(){
  const w = parseFloat(document.getElementById('doseWeight').value);
  const d = parseFloat(document.getElementById('dosePerKg').value);
  const out = document.getElementById('doseResult');
  if(!w || !d){out.textContent='Enter weight and dose per kg.';return}
  out.textContent = `Total dose: ${(w*d).toFixed(2)} mg`;
}

function calcIV(){
  const vol = parseFloat(document.getElementById('ivVolume').value);
  const hrs = parseFloat(document.getElementById('ivHours').value);
  const set = parseFloat(document.getElementById('ivSet').value);
  const out = document.getElementById('ivResult');
  if(!vol || !hrs || !set){out.textContent='Enter volume, time and set.';return}
  const mLperHr = vol / hrs;
  const dropsPerMin = (mLperHr * set) / 60;
  out.textContent = `${mLperHr.toFixed(1)} mL/hr — approx ${dropsPerMin.toFixed(0)} drops/min`;
}

function calcBSA(){
  const w = parseFloat(document.getElementById('bsaW').value);
  const h = parseFloat(document.getElementById('bsaH').value);
  const out = document.getElementById('bsaResult');
  if(!w || !h){out.textContent='Enter weight and height.';return}
  const bsa = Math.sqrt((w * h) / 3600);
  out.textContent = `BSA: ${bsa.toFixed(3)} m²`;
}

function calcEDD(){
  const lmp = document.getElementById('lmp').value;
  const out = document.getElementById('eddResult');
  if(!lmp){out.textContent='Select LMP date.';return}
  const d = new Date(lmp);
  d.setDate(d.getDate() + 280);
  out.textContent = `Estimated Due Date: ${d.toISOString().slice(0,10)}`;
}

function convTemp(){
  const v = parseFloat(document.getElementById('tempInput').value);
  const from = document.getElementById('tempFrom').value;
  const to = document.getElementById('tempTo').value;
  const out = document.getElementById('tempResult');
  if(isNaN(v)){out.textContent='Enter a temperature value.';return}
  let c;
  if(from==='c')c=v;
  if(from==='f')c=(v-32)/1.8;
  if(from==='k')c=v-273.15;
  let res;
  if(to==='c')res=c;
  if(to==='f')res=c*1.8+32;
  if(to==='k')res=c+273.15;
  out.textContent = `${res.toFixed(2)} ${to.toUpperCase()}`;
}

function unitConv(){
  const v = parseFloat(document.getElementById('unitVal').value);
  const t = document.getElementById('unitType').value;
  const out = document.getElementById('unitResult');
  if(isNaN(v)){out.textContent='Enter a value.';return}
  let r;
  switch(t){
    case 'mg_to_g': r = v/1000; out.textContent = `${r} g`; break;
    case 'g_to_mg': r = v*1000; out.textContent = `${r} mg`; break;
    case 'ml_to_l': r = v/1000; out.textContent = `${r} L`; break;
    case 'l_to_ml': r = v*1000; out.textContent = `${r} mL`; break;
    case 'mcg_to_mg': r = v/1000; out.textContent = `${r} mg`; break;
    default: out.textContent='Unknown conversion';
  }
}

// Appointments stored in localStorage for demo
function saveAppt(){
  const name = document.getElementById('apptName').value;
  const dt = document.getElementById('apptDT').value;
  const out = document.getElementById('apptList');
  if(!name || !dt){out.textContent='Enter patient name and date/time.';return}
  const appts = JSON.parse(localStorage.getItem('appts')||'[]');
  appts.push({name:name,dt:dt});
  localStorage.setItem('appts',JSON.stringify(appts));
  renderAppts();
}
function renderAppts(){
  const out = document.getElementById('apptList');
  const appts = JSON.parse(localStorage.getItem('appts')||'[]');
  if(appts.length===0){out.textContent='No appointments saved.';return}
  out.innerHTML = appts.map(a=>`${a.dt} — ${a.name}`).join('<br>');
}
renderAppts();

function symptomTriage(){
  const f = document.getElementById('symFever').value;
  const b = document.getElementById('symBreath').value;
  const c = document.getElementById('symChest').value;
  const out = document.getElementById('symResult');
  if(b==='yes' || c==='yes'){
    out.innerHTML = '<strong style="color:#b00">Seek urgent care / emergency services.</strong>';
  } else if(f==='yes'){
    out.textContent = 'Monitor symptoms, consider primary care or telemedicine evaluation.';
  } else {
    out.textContent = 'Low acuity—self care and observation.';
  }
}

function calcHR(){
  const rr = parseFloat(document.getElementById('ecgRR').value);
  const out = document.getElementById('ecgResult');
  if(!rr){out.textContent='Enter RR interval (s).';return}
  const hr = 60/rr;
  out.textContent = `Heart rate: ${Math.round(hr)} bpm`;
}

function calcInfusion(){
  // concentration: mg in mL; dose: mcg/kg/min -> compute mL/hr
  const mg = parseFloat(document.getElementById('infMg').value);
  const vol = parseFloat(document.getElementById('infVol').value);
  const dose = parseFloat(document.getElementById('infDose').value);
  const w = parseFloat(document.getElementById('infW').value);
  const out = document.getElementById('infResult');
  if(!mg || !vol || !dose || !w){out.textContent='Complete all fields.';return}
  // mg per mL
  const conc_mg_per_ml = mg / vol;
  // desired mcg/min total = dose * weight
  const mcg_per_min = dose * w;
  const mg_per_min = mcg_per_min/1000;
  const ml_per_min = mg_per_min / conc_mg_per_ml;
  const ml_per_hr = ml_per_min * 60;
  out.textContent = `${ml_per_hr.toFixed(2)} mL/hr`;
}

</script>
</body>
</html>